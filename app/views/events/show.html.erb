<script src="//maps.google.com/maps/api/js?key="></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<script src='//cdn.jsdelivr.net/gmaps4rails/2.1.2/gmaps4rails.js'> </script>
<script src='//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore.js'> </script>

<% if user_signed_in? %>

<div class="rounded-top">
<h1 class="text-center">
  <%= @event.title_event %>
</h1>
<p class="text-center"> Description : <%= @event.description_event %> </p>
<p class="text-center"> Lieu : <%= @event.city %> <%= @event.address %></p>
<p class="text-center"> Date : <%= @event.starting_date.strftime("%d-%m-%Y") %> </p>
<p class="text-center"> Créateur : <%= @event.creator.email %> </p>
  <% if @event.picture.attached? %>
   <p class="text-center"> Image d'illustration : <%= image_tag @event.picture %> </p>

  <% else %>
  
  <% end %>

</div>
  
 
<% if @event.attendees.count <= @event.number_of_places && unless @event.attendees.include? current_user %>
<p class="text-center"> <%= link_to "Rejoindre l'événement", { :controller => "events", :action => "subscribe"}, class: "btn btn-success" %> </p>
<% else  @event.attendees.include? current_user %>
<p class="text-center"> Deja inscrit ! :) </p>
<% end %>
<% end %>


<h2> Liste des participants </h2>

<table class="table table-striped">
      <tr>
      <th>Nom</th>
      <th>Adresse mail</th>
      <th></th>

    </tr>

  <% @event.attendees.each do |attendee| %> 
    <tr>
    <td> <%= attendee.email %> </td>
    <td> <%= link_to('Voir le profil du participant', user_path(attendee)) %> </td>
    </tr>
    <% end %>
  </table>

<div style='width: 800px;'>
  <div id="map" style='width: 800px; height: 400px;'></div>
</div>

<script type="text/javascript">
handler = Gmaps.build('Google');
handler.buildMap({ provider: { Zoom: -3 }, internal: {id: 'map'}}, function(){
  markers = handler.addMarkers([
    {
      "lat":  <%= @event.latitude %>,
      "lng":  <%= @event.longitude %>,
      "infowindow": "hello!"
    }
  ]);
  handler.bounds.extendWith(markers);
  handler.fitMapToBounds();
  handler.getMap().setZoom(15)
});
</script>

  <% else %>

Veuillez vous connecter pour voir la page du voyages LIEN

<% end %>

